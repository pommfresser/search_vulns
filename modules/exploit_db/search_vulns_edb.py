from typing import List

from modules.exploit_db.build import full_update
from vulnerability import Vulnerability


def add_extra_vuln_info(vulns: List[Vulnerability], vuln_db_cursor, config, **misc):
    for vuln_id, vuln in vulns.items():
        vuln_cve_ids = set()
        if vuln_id.startswith("CVE-"):
            vuln_cve_ids.add(vuln_id)
        for alias in vuln.aliases:
            if alias.startswith("CVE-"):
                vuln_cve_ids.add(alias)

        exploits = set()
        for cve_id in vuln_cve_ids:
            vuln_db_cursor.execute("SELECT edb_ids FROM cve_edb WHERE cve_id = ?", (cve_id,))
            edb_ids = vuln_db_cursor.fetchone()
            if edb_ids and edb_ids[0]:
                edb_ids = edb_ids[0].strip()
                if edb_ids:
                    for edb_id in edb_ids.split(","):
                        exploits.add("https://www.exploit-db.com/exploits/%s" % edb_id)

        vuln.add_exploits(exploits)
