#!/usr/bin/env python3

import unittest
import subprocess

class TestSearches(unittest.TestCase): 

    def test_search_wp_572(self):
        self.maxDiff = None
        result = subprocess.run(['python', 'search_vulns.py', '-q', 'cpe:2.3:a:wordpress:wordpress:5.7.2:*:*:*:*:*:*:*'], capture_output=True, text=True)
        expected_description = ["https://www.exploit-db.com/exploits/5035", "https://www.exploit-db.com/exploits/4993", "https://www.exploit-db.com/exploits/50663"]
        for description_elem in expected_description:
            self.assertIn(description_elem, result.stdout)

    def test_search_apache_2425(self):
        self.maxDiff = None
        result = subprocess.run(['python', 'search_vulns.py', '-q', 'cpe:2.3:a:apache:http_server:2.4.25:*:*:*:*:*:*:*'], capture_output=True, text=True)
        expected_description = ["https://www.exploit-db.com/exploits/29739", "https://www.exploit-db.com/exploits/19244", "https://www.exploit-db.com/exploits/47688", "https://www.exploit-db.com/exploits/47689", "https://www.exploit-db.com/exploits/20595", "https://www.exploit-db.com/exploits/42745", "https://www.exploit-db.com/exploits/46676"]
        for description_elem in expected_description:
            self.assertIn(description_elem, result.stdout)

    def test_search_proftpd_133c(self):
        self.maxDiff = None
        result = subprocess.run(['python', 'search_vulns.py', '-q', 'cpe:2.3:a:proftpd:proftpd:1.3.3:c:*:*:*:*:*:*'], capture_output=True, text=True)
        expected_description = ["https://www.exploit-db.com/exploits/16129"]
        for description_elem in expected_description:
            self.assertIn(description_elem, result.stdout)

    def test_search_redis_323(self):
        self.maxDiff = None
        result = subprocess.run(['python', 'search_vulns.py', '-q', 'cpe:2.3:a:redis:redis:3.2.3:*:*:*:*:*:*:*'], capture_output=True, text=True)
        expected_description = ["https://www.exploit-db.com/exploits/44908", "https://www.exploit-db.com/exploits/44904"]
        for description_elem in expected_description:
            self.assertIn(description_elem, result.stdout)

    # def test_search_piwik_045(self):
    #     self.maxDiff = None
    #     result = subprocess.run(['python', 'search_vulns.py', '-q', 'cpe:2.3:a:wordpress:wordpress:5.7.2:*:*:*:*:*:*:*'], capture_output=True, text=True)
    #     expected_cves = ['CVE-2007-1622','CVE-2007-2627','CVE-2007-2757','CVE-2007-4014','CVE-2007-4165','CVE-2007-6677','CVE-2008-0198','CVE-2008-0491','CVE-2008-0615','CVE-2008-0616','CVE-2008-0617','CVE-2008-0618','CVE-2021-39200','CVE-2021-39201','CVE-2021-44223','CVE-2022-21661','CVE-2022-21662','CVE-2022-21663','CVE-2022-21664','CVE-2022-3590','CVE-2022-43497','CVE-2022-43500','CVE-2022-43504','CVE-2023-22622','CVE-2023-2745']
    #     for expected_cve in expected_cves:
    #         self.assertIn(expected_cve, result.stdout)

if __name__ == '__main__':
    unittest.main()